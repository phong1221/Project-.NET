@model StoreManagement.Web.Helpers.PaginatedList<StoreManagement.Data.Entities.Order>

@{
    ViewData["Title"] = "Danh sách hóa đơn";
}

<h1 class="h3 mb-4 text-gray-800">Lịch sử hóa đơn</h1>

<div class="card shadow mb-4">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-bordered table-striped" width="100%" cellspacing="0">
                <thead class="bg-primary text-white">
                    <tr>
                        <th>Mã HĐ</th>
                        <th>Ngày tạo</th>
                        <th>Khách hàng</th>
                        <th>Người tạo</th>
                        <th>Tổng tiền</th>
                        <th>Trạng thái</th>
                        <th>Chi tiết</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td>#@item.OrderId</td>
                            <td>@item.OrderDate.ToString("dd/MM/yyyy HH:mm")</td>
                            <td>@(item.Customer?.Name ?? "Khách lẻ")</td>
                            <td>@(item.User?.Username ?? "N/A")</td>
                            <td class="text-danger fw-bold">@((item.TotalAmount ?? 0).ToString("N0")) ₫</td>
                            <td>
                                @if(item.Status == "paid") {
                                    <span class="badge bg-success">Đã thanh toán</span>
                                } else if(item.Status == "pending") {
                                     <span class="badge bg-warning text-dark">Chờ xử lý</span>
                                } else {
                                    <span class="badge bg-secondary">@item.Status</span>
                                }
                            </td>
                            <td>
                                <a asp-action="Details" asp-route-id="@item.OrderId" class="btn btn-sm btn-info text-white"><i class="fas fa-eye"></i></a>
                                @if(item.Status == "pending")
                                {
                                    <form asp-action="Confirm" asp-route-id="@item.OrderId" method="post" id="confirm-form-@item.OrderId" style="display:inline-block">
                                        <button type="button" class="btn btn-sm btn-success" onclick="confirmOrder(@item.OrderId)"><i class="fas fa-check"></i> Duyệt</button>
                                    </form>
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
         <!-- Pagination -->
        <nav aria-label="Page navigation" class="mt-3">
            <ul class="pagination justify-content-center">
                <li class="page-item @(Model.HasPreviousPage ? "" : "disabled")">
                    <a class="page-link" asp-action="Index"
                       asp-route-pageNumber="@(Model.PageIndex - 1)">Trước</a>
                </li>
                <li class="page-item disabled"><span class="page-link">Trang @Model.PageIndex / @Model.TotalPages</span></li>
                <li class="page-item @(Model.HasNextPage ? "" : "disabled")">
                    <a class="page-link" asp-action="Index"
                       asp-route-pageNumber="@(Model.PageIndex + 1)">Sau</a>
                </li>
            </ul>
        </nav>
    </div>
</div>

@section Scripts {
    <script>
        function confirmOrder(id) {
            Swal.fire({
                title: 'Xác nhận đơn hàng?',
                text: "Bạn có chắc chắn muốn xác nhận và thanh toán?",
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#198754',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Đồng ý',
                cancelButtonText: 'Hủy bỏ'
            }).then((result) => {
                if (result.isConfirmed) {
                    document.getElementById('confirm-form-' + id).submit();
                }
            })
        }
    </script>
}
