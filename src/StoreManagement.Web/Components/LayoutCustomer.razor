@inherits LayoutComponentBase
@inject NavigationManager nav
@inject CustomerAuthService AuthService
@inject CartService CartService

<div class="container-fluid p-0">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark px-4">
        <a class="navbar-brand" href="/user">STORE ONLINE</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCust">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarCust">
            <ul class="navbar-nav me-auto">
                <li class="nav-item"><a class="nav-link" href="/user">Trang chủ</a></li>
            </ul>
            <ul class="navbar-nav ms-auto">
                <li class="nav-item">
                    <a class="nav-link" href="/user/cart">
                        <i class="fas fa-shopping-cart"></i> Giỏ hàng (@CartService.Items.Sum(i => i.Quantity))
                    </a>
                </li>
                 @if (AuthService.IsLoggedIn)
                {
                     <li class="nav-item"><span class="nav-link">Chào, @AuthService.CurrentCustomer.Name</span></li>
                     <li class="nav-item"><a class="nav-link" href="/user/profile">Thông tin cá nhân</a></li>
                     <li class="nav-item"><a class="nav-link" href="#" @onclick="Logout">Đăng xuất</a></li>
                }
                else
                {
                    <li class="nav-item"><a class="nav-link" href="/user/login">Đăng nhập</a></li>
                    <li class="nav-item"><a class="nav-link" href="/user/register">Đăng ký</a></li>
                }
            </ul>
        </div>
    </nav>
    
    <!-- Content -->
    <div class="container mt-4">
        @Body
    </div>
    
    <!-- Footer -->
    <footer class="bg-light text-center py-3 mt-5 border-top">
        <small>&copy; 2025 Store Management System</small>
    </footer>
</div>

@code {
    protected override void OnInitialized()
    {
        AuthService.OnChange += StateHasChanged;
        CartService.OnChange += StateHasChanged;
    }

    public void Dispose()
    {
         AuthService.OnChange -= StateHasChanged;
         CartService.OnChange -= StateHasChanged;
    }

    void Logout()
    {
        AuthService.Logout();
        nav.NavigateTo("/user", forceLoad: true);
    }
}
