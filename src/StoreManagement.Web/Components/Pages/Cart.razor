@page "/user/cart"
@inject CartService CartService
@inject NavigationManager Nav
@inject CustomerAuthService AuthService

<h2>Giỏ hàng của bạn</h2>

@if (!CartService.Items.Any())
{
    <p>Giỏ hàng trống.</p>
    <a href="/user" class="btn btn-outline-primary">Tiếp tục mua sắm</a>
}
else
{
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Sản phẩm</th>
                <th>Giá</th>
                <th>Số lượng</th>
                <th>Thành tiền</th>
                <th>Thao tác</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in CartService.Items)
            {
                <tr>
                    <td>@item.Product.ProductName</td>
                    <td>@item.Product.Price.ToString("N0")</td>
                    <td>
                        <div class="input-group input-group-sm" style="width: 120px;">
                            <button class="btn btn-outline-secondary" @onclick="async () => { if (item.Quantity > 1) await CartService.AddToCartAsync(item.Product, -1); }">-</button>
                            <span class="form-control text-center">@item.Quantity</span>
                            <button class="btn btn-outline-secondary" @onclick="async () => await CartService.AddToCartAsync(item.Product, 1)">+</button>
                        </div>
                    </td>
                    <td>@((item.Product.Price * item.Quantity).ToString("N0"))</td>
                    <td>
                        <button class="btn btn-sm btn-danger" @onclick="async () => await CartService.RemoveFromCartAsync(item.Product)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            }
        </tbody>
    </table>
    
    <div class="d-flex justify-content-end">
        <h4>Tổng cộng: <span class="text-danger">@CartService.TotalAmount.ToString("N0") ₫</span></h4>
    </div>
    
    <div class="mt-3 text-end">
        @if (AuthService.IsLoggedIn)
        {
             <a href="/user/checkout" class="btn btn-success btn-lg">Đặt hàng</a>
        }
        else
        {
            <div class="alert alert-warning">Vui lòng <a href="/user/login">đăng nhập</a> để đặt hàng.</div>
        }
    </div>
}
