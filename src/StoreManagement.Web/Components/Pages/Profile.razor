@page "/user/profile"
@inject CustomerAuthService AuthService
@inject ICustomerService CustomerService
@inject NavigationManager Nav
@inject IJSRuntime JSRuntime

<div class="container animate__animated animate__fadeIn">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="text-primary"><i class="fas fa-user-circle"></i> Thông tin cá nhân</h2>
        <a href="/user" class="btn btn-outline-secondary"><i class="fas fa-arrow-left"></i> Quay lại trang chủ</a>
    </div>

    @if (AuthService.CurrentCustomer == null)
    {
        <p>Bạn chưa đăng nhập.</p>
    }
    else
    {
        <div class="row">
            <div class="col-md-6 mb-4">
                <div class="card shadow border-0 rounded-3">
                    <div class="card-header bg-gradient bg-primary text-white">
                        <h5 class="m-0"><i class="fas fa-edit"></i> Cập nhật thông tin</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="fw-bold">Họ tên</label>
                            <input class="form-control" @bind="customer.Name" />
                        </div>
                        <div class="mb-3">
                            <label class="fw-bold">Số điện thoại</label>
                            <input class="form-control" @bind="customer.Phone" />
                        </div>
                        <div class="mb-3">
                            <label class="fw-bold">Email</label>
                            <input class="form-control" @bind="customer.Email" />
                        </div>
                        <div class="mb-3">
                            <label class="fw-bold">Địa chỉ</label>
                            <textarea class="form-control" rows="3" @bind="customer.Address"></textarea>
                        </div>
                        
                        <button class="btn btn-primary w-100" @onclick="UpdateProfile">
                           <i class="fas fa-save"></i> Lưu thay đổi
                        </button>
                    </div>
                </div>
            </div>
             <div class="col-md-6">
                 <div class="alert alert-info shadow-sm" role="alert">
                     <h4 class="alert-heading"><i class="fas fa-smile-wink"></i> Xin chào, @customer.Name!</h4>
                     <p>Cảm ơn bạn đã là thành viên của cửa hàng. Tại đây bạn có thể cập nhật thông tin cá nhân của mình.</p>
                     <hr>
                     <p class="mb-0">Chúc bạn mua sắm vui vẻ!</p>
                 </div>
                 
                 <!-- Placeholder for future animated widget -->
                 <div class="text-center mt-5">
                     <img src="https://cdni.iconscout.com/illustration/premium/thumb/user-profile-2839460-2371900.png" 
                          alt="Profile" style="max-width: 250px;" class="img-fluid animate__animated animate__pulse animate__infinite" />
                 </div>
             </div>
        </div>
    }
</div>

@code {
    Customer customer;
    
    protected override void OnInitialized()
    {
        if (!AuthService.IsLoggedIn)
        {
            Nav.NavigateTo("/user/login");
        }
        else
        {
            var c = AuthService.CurrentCustomer;
            customer = new Customer 
            { 
                CustomerId = c.CustomerId,
                Name = c.Name,
                Phone = c.Phone,
                Email = c.Email,
                Address = c.Address,
                Password = c.Password
            };
        }
    }

    async Task UpdateProfile()
    {
        await CustomerService.UpdateCustomerAsync(customer);
        
        AuthService.CurrentCustomer.Name = customer.Name;
        AuthService.CurrentCustomer.Phone = customer.Phone;
        AuthService.CurrentCustomer.Email = customer.Email;
        AuthService.CurrentCustomer.Address = customer.Address;
        
        await JSRuntime.InvokeVoidAsync("ShowToast", "success", "Cập nhật thành công!");
    }
}
